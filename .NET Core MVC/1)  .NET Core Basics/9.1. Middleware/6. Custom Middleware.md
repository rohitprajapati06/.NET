# ✅ Custom Middleware in ASP.NET Core

Middleware in ASP.NET Core is software that processes HTTP requests and responses in a pipeline. Custom middleware lets you insert your own logic into that pipeline.

---

## 📌 Basic Structure

```csharp
public class MyCustomMiddleware
{
    private readonly RequestDelegate _next;

    public MyCustomMiddleware(RequestDelegate next)
    {
        _next = next;
    }

    public async Task InvokeAsync(HttpContext context)
    {
        // Code before the next middleware
        await context.Response.WriteAsync("Before Middleware\n");

        await _next(context); // Call the next middleware

        // Code after the next middleware
        await context.Response.WriteAsync("After Middleware\n");
    }
}
```

---

## 🛠️ Register Middleware

### ✅ .NET 6+ (Program.cs)

```csharp
var builder = WebApplication.CreateBuilder(args);
var app = builder.Build();

app.UseMiddleware<MyCustomMiddleware>();

app.Run(async context =>
{
    await context.Response.WriteAsync("Hello from endpoint\n");
});
```

---

### ✅ .NET 5 or Earlier (Startup.cs)

```csharp
public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
{
    app.UseMiddleware<MyCustomMiddleware>();

    app.Run(async context =>
    {
        await context.Response.WriteAsync("Hello from endpoint\n");
    });
}
```

---

## 🎯 Example Output

```
Before Middleware
Hello from endpoint
After Middleware
```

---

## ✨ Inline Middleware Shortcut

```csharp
app.Use(async (context, next) =>
{
    await context.Response.WriteAsync("Start\n");
    await next();
    await context.Response.WriteAsync("End\n");
});
```

---

## 🧩 Real-World Use Cases

- Request/response logging
- Exception handling
- Authentication
- Custom headers
- API rate limiting
- Performance monitoring

---

## 📝 Notes

- Middleware is executed **in the order it is added**.
- Always use `async`/`await` for non-blocking performance.
- `app.Run()` is a terminal middleware — no further middleware runs after it.

